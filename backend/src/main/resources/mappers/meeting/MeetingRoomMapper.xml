<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spec.plun.meeting.room.MeetingRoomMapper">

  <resultMap id="MeetingRoomMap" type="com.spec.plun.meeting.room.MeetingRoom">
    <id     property="roomNo" column="room_no"/>
    <result property="teamNo" column="team_no"/>
    <result property="title" column="title"/>
    <result property="scheduledTime" column="scheduled_time"/>
    <result property="scheduledEndTime" column="scheduled_end_time"/>
    <result property="startedTime" column="started_time"/>
    <result property="endedTime" column="ended_time"/>
    <result property="roomCode" column="room_code"/>
    <result property="isPrivate" column="is_private"/>
    <result property="roomPasswordHash" column="room_password_hash"/>
    <result property="createDate" column="create_date"/>
    <result property="updateDate" column="update_date"/>
  </resultMap>

  <!-- INSERT: AUTO_INCREMENT PK(room_no)를 room.roomNo에 채워줌 -->
  <insert id="insert" parameterType="com.spec.plun.meeting.room.MeetingRoom"
          useGeneratedKeys="true" keyProperty="roomNo">
    INSERT INTO tb_meeting_room
      (team_no, title, scheduled_time, scheduled_end_time, room_code, is_private, room_password_hash)
    VALUES
      (#{teamNo}, #{title},
       COALESCE(#{scheduledTime}, NOW()),
       #{scheduledEndTime},
       #{roomCode},
       COALESCE(#{isPrivate}, 'N'),
       #{roomPasswordHash})
  </insert>

  <select id="findById" resultMap="MeetingRoomMap">
    SELECT * FROM tb_meeting_room WHERE room_no = #{roomNo}
  </select>

  <select id="findByCode" resultMap="MeetingRoomMap">
    SELECT * FROM tb_meeting_room WHERE room_code = #{roomCode}
  </select>

  <select id="listRecent" resultMap="MeetingRoomMap">
    SELECT *
    FROM tb_meeting_room
    ORDER BY create_date DESC
    LIMIT 20
  </select>
</mapper>
